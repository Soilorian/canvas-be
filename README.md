# Canvas Backend - بک‌اند Canvas

یک اپلیکیشن بک‌اند Spring Boot برای مدیریت حالت‌های نقاشی با اشکال مختلف.

## ویژگی‌ها

- ذخیره حالت‌های نقاشی با اشکال در پایگاه داده PostgreSQL
- بازیابی حالت‌های نقاشی بر اساس نام
- API های RESTful
- اعتبارسنجی ورودی
- مدیریت خطا
- ذخیره‌سازی پایگاه داده با JPA/Hibernate

## پیش‌نیازها

- Java 21
- پایگاه داده PostgreSQL
- Gradle

## راه‌اندازی

### ۱. راه‌اندازی پایگاه داده
- یک پایگاه داده PostgreSQL با نام `canvas_db` ایجاد کنید
- جزئیات اتصال پایگاه داده را در فایل `src/main/resources/application.properties` به‌روزرسانی کنید:
  ```properties
  spring.datasource.url=jdbc:postgresql://localhost:5432/canvas_db
  spring.datasource.username=نام_کاربری_شما
  spring.datasource.password=رمز_عبور_شما
  ```

### ۲. ساخت و اجرا
```bash
./gradlew build
./gradlew bootRun
```

اپلیکیشن روی آدرس `http://localhost:8080` شروع خواهد شد.

## ساختار پروژه

```
src/main/java/org/example/canvasbe/
├── CanvasBeApplication.java          # کلاس اصلی اپلیکیشن
├── controller/                       # کنترلرهای REST API
├── service/                          # لایه سرویس و منطق کسب‌وکار
├── repository/                       # لایه دسترسی به داده
├── entity/                          # موجودیت‌های JPA
├── dto/                             # اشیاء انتقال داده
├── exception/                       # مدیریت استثناها
└── config/                          # تنظیمات اپلیکیشن
```

### توضیح لایه‌ها:

#### ۱. Controller Layer (لایه کنترلر)
- مسئول مدیریت درخواست‌ها و پاسخ‌های HTTP
- تعریف endpoint های REST API
- اعتبارسنجی ورودی‌ها

#### ۲. Service Layer (لایه سرویس)
- شامل منطق کسب‌وکار اصلی
- پردازش داده‌ها قبل از ذخیره‌سازی
- مدیریت تراکنش‌ها

#### ۳. Repository Layer (لایه مخزن)
- لایه دسترسی به داده با استفاده از Spring Data JPA
- عملیات CRUD روی پایگاه داده

#### ۴. Entity Layer (لایه موجودیت)
- موجودیت‌های JPA برای نگاشت پایگاه داده
- تعریف روابط بین جداول

#### ۵. DTO Layer (لایه انتقال داده)
- اشیاء انتقال داده برای ارتباط API
- جداسازی مدل‌های داخلی از API

## API Endpoints

### ذخیره حالت نقاشی
- **POST** `/api/drawing-states`
- **Content-Type**: `application/json`
- **بدنه درخواست**:
  ```json
  {
    "name": "نقاشی-من",
    "shapes": [
      {
        "id": "شکل-۱",
        "type": "SQUARE",
        "x": 100.0,
        "y": 100.0,
        "width": 50.0,
        "height": 50.0,
        "rotation": 0.0,
        "color": "#FF0000"
      }
    ]
  }
  ```

### دریافت حالت نقاشی
- **GET** `/api/drawing-states/{name}`
- **پاسخ**: حالت نقاشی با نام مشخص شده را برمی‌گرداند

## مدل‌های داده

### انواع اشکال
- `SQUARE` - مربع
- `CIRCLE` - دایره
- `TRIANGLE` - مثلث
- `DIAMOND` - لوزی

### قوانین اعتبارسنجی
- تمام ویژگی‌های شکل الزامی هستند
- مختصات X و Y باید غیرمنفی باشند
- عرض و ارتفاع باید مثبت باشند (> 0.1)
- نام حالت نقاشی الزامی است و نمی‌تواند خالی باشد
- لیست اشکال الزامی است

## معماری

این اپلیکیشن از معماری لایه‌ای پیروی می‌کند:

```
┌─────────────────┐
│   Controller    │ ← لایه کنترلر (مدیریت HTTP)
├─────────────────┤
│     Service     │ ← لایه سرویس (منطق کسب‌وکار)
├─────────────────┤
│   Repository    │ ← لایه مخزن (دسترسی به داده)
├─────────────────┤
│     Entity      │ ← لایه موجودیت (نگاشت پایگاه داده)
└─────────────────┘
```

## مدیریت خطا

اپلیکیشن مدیریت خطای جامعی ارائه می‌دهد:

- **۴۰۴**: حالت نقاشی یافت نشد
- **۴۰۰**: خطاهای اعتبارسنجی
- **۵۰۰**: خطاهای داخلی سرور

تمام خطاها پاسخ‌های JSON ساختاریافته با کدهای وضعیت HTTP مناسب برمی‌گردانند.

## طرح پایگاه داده

اپلیکیشن به طور خودکار جداول زیر را ایجاد می‌کند:
- `drawing_states`: ذخیره اطلاعات حالت نقاشی
- `shapes`: ذخیره اطلاعات اشکال با کلید خارجی به حالت‌های نقاشی

## توسعه

### اجرای تست‌ها
```bash
./gradlew test
```

### ساخت اپلیکیشن
```bash
./gradlew build
```

### وابستگی‌های اصلی
- Spring Boot 3.5.4
- Spring Data JPA
- PostgreSQL Driver
- Jackson (برای JSON)
- H2 Database (برای تست‌ها)

## نکات مهم

- این پروژه از Java 21 استفاده می‌کند
- از Gradle برای مدیریت وابستگی‌ها استفاده می‌شود
- پایگاه داده PostgreSQL برای محیط تولید استفاده می‌شود
- پایگاه داده H2 برای تست‌ها استفاده می‌شود
- تمام endpoint ها از JSON برای تبادل داده استفاده می‌کنند 
